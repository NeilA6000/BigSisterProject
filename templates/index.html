<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BigSister - Your Anonymous Support</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

    <header class="hidden">
        <nav>
            <div class="logo">
                <img src="{{ url_for('static', filename='img/BigSister.png') }}" alt="BigSister Logo">
                <span id="welcome-user"></span>
            </div>
            <ul class="nav-links">
                <li><a href="#" data-section="chat-section" data-translate-key="nav_chat">Chat</a></li>
                <li><a href="#" data-section="journal-section" data-translate-key="nav_journal">Journal</a></li>
                <li><a href="#" data-section="community-section" data-translate-key="nav_community">Community</a></li>
                <li><a href="#" data-section="mind-matters-section" data-translate-key="nav_mind_matters">Mind Matters</a></li>
                <li><a href="#" data-section="resources-section" data-translate-key="nav_resources">Resources</a></li>
                <li><a href="#" data-section="settings-section" data-translate-key="nav_settings">Settings</a></li>
                <li><a href="#" data-section="about-section" data-translate-key="nav_about">About</a></li>
            </ul>
            <div class="controls">
                <select id="language-switcher"><option value="en">English</option><option value="es">Español</option><option value="fr">Français</option></select>
                <div class="theme-switch-wrapper">
                    <label class="theme-switch" for="theme-checkbox"><input type="checkbox" id="theme-checkbox" /><div class="slider round"></div></label>
                </div>
                <button id="logout-btn" class="cta-button" data-translate-key="logout_btn">Logout</button>
            </div>
        </nav>
    </header>

    <main>
        <!-- User Auth Section -->
        <section id="auth-section">
            <div class="auth-container">
                <div class="auth-box" id="login-box">
                    <h1 data-translate-key="login_title">Welcome Back</h1>
                    <p data-translate-key="login_subtitle">Enter your username and PIN to continue.</p>
                    <input type="text" id="login-username" placeholder="Username" data-translate-key="username_placeholder">
                    <input type="password" id="login-pin" placeholder="4-Digit PIN" data-translate-key="pin_placeholder" maxlength="4" inputmode="numeric">
                    <button id="login-btn" class="cta-button" data-translate-key="login_btn">Login</button>
                    <p id="login-error" class="error-message"></p>
                    <a href="#" id="show-signup" data-translate-key="show_signup_link">Don't have an account? Sign up.</a>
                </div>
                <div class="auth-box hidden" id="signup-box">
                    <h1 data-translate-key="signup_title">Create Your Private Account</h1>
                    <p data-translate-key="signup_subtitle">Choose a username and a 4-digit PIN.</p>
                    <input type="text" id="signup-username" placeholder="Username" data-translate-key="username_placeholder">
                    <button id="signup-btn" class="cta-button" data-translate-key="signup_btn">Sign Up</button>
                    <p id="signup-error" class="error-message"></p>
                    <a href="#" id="show-login" data-translate-key="show_login_link">Already have an account? Login.</a>
                </div>
            </div>
        </section>

        <!-- Quiz Section -->
        <section id="quiz-section" class="hidden">
            <div class="quiz-container">
                <h1 data-translate-key="quiz_title">Welcome. Let's see how you're feeling.</h1>
                <p data-translate-key="quiz_subtitle">Your answers help create a private emotional snapshot for this session.</p>
                <div id="question-area">
                    <h2 id="question-text"></h2>
                    <div id="answer-buttons" class="answer-grid"></div>
                </div>
                <div id="quiz-complete" class="hidden">
                    <h2 data-translate-key="quiz_thanks">Thank you for sharing.</h2>
                    <p data-translate-key="quiz_next_steps">You can now start chatting with BigSister.</p>
                    <button class="cta-button" id="start-chat-btn" data-translate-key="quiz_start_chat">Start Chat</button>
                </div>
            </div>
        </section>
        
        <!-- Chat Section -->
        <section id="chat-section" class="hidden">
            <div class="chat-layout">
                <div class="sidebar">
                    <h3 data-translate-key="sessions_title">Sessions</h3>
                    <ul id="session-list"></ul>
                    <button id="new-session-btn" class="cta-button full-width" data-translate-key="new_session_btn">+ New Session</button>
                </div>
                <div class="chat-container">
                    <div class="chat-header">
                        <h3 id="chat-session-name">Big Sister</h3>
                        <button id="end-session-btn" class="cta-button small-btn hidden">End Session</button>
                    </div>
                    <div class="chat-messages" id="chat-messages"></div>
                    <div class="chat-input-form">
                        <input type="text" id="chat-input" placeholder="Type your message here...">
                        <button id="send-btn"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Journal Section (RESTORED reflect button)-->
        <section id="journal-section" class="hidden">
            <h1 data-translate-key="journal_title">Private Journal</h1>
            <div class="journal-layout">
                <div id="journal-list-container">
                    <h3>Your Entries</h3>
                    <div id="journal-list"></div>
                </div>
                <div id="journal-editor-container">
                    <h3 id="editor-heading">New Entry</h3>
                    <input type="text" id="journal-title" placeholder="Entry Title">
                    <textarea id="journal-content" placeholder="Write what's on your mind..."></textarea>
                    <div class="editor-buttons">
                        <button id="save-journal-btn" class="cta-button">Save Entry</button>
                        <button id="delete-journal-btn" class="cta-button danger-btn hidden">Delete</button>
                        <button id="reflect-journal-btn" class="cta-button secondary-btn hidden">Reflect with BigSister</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Community Section -->
        <section id="community-section" class="hidden">
            <h1>A Wall of Support</h1>
            <p>Read anonymous, supportive messages from others, and leave one of your own. All messages are strictly reviewed by an AI to keep this a safe space.</p>
            <div class="community-layout">
                <div id="my-message-container" class="setting-card">
                    <h3>Your Anonymous Message</h3>
                    <p class="privacy-notice">You can post one message to the wall. It will be reviewed by our AI moderator before it appears publicly. Your username is never shown.</p>
                    <textarea id="my-message-textarea" rows="4" placeholder="Write something kind and supportive..."></textarea>
                    <div id="my-message-status"></div>
                    <button id="save-my-message-btn" class="cta-button">Save & Submit for Review</button>
                </div>
                <div id="message-wall-container">
                    <div id="message-wall"></div>
                </div>
            </div>
        </section>

        <!-- Mind Matters (Audio) Section -->
        <section id="mind-matters-section" class="hidden">
            <h1>Mind Matters</h1>
            <p>A collection of guided audio sessions to help you find your calm.</p>
            <div id="audio-gallery" class="audio-gallery-grid"></div>
        </section>

        <!-- Resources Section -->
        <section id="resources-section" class="hidden">
            <h1>Support Services & Hotlines</h1>
            <p>Select your country from the dropdown to find relevant hotlines and services.</p>
            <div class="filters">
                <select id="filter-country"><option value="all">All Countries</option><option value="USA">USA</option><option value="Canada">Canada</option><option value="UK">UK</option></select>
                <select id="filter-type"><option value="all">All Service Types</option><option value="General">General</option><option value="LGBTQ+">LGBTQ+</option><option value="Substance Abuse">Substance Abuse</option><option value="Crisis">Crisis</option></select>
                <select id="filter-anonymity"><option value="all">All Anonymity</option><option value="Anonymous">Anonymous</option><option value="Confidential">Confidential</option></select>
            </div>
            <div id="resource-list" class="resource-grid"></div>
        </section>
        
        <!-- Emergency Section (RESTORED) -->
        <section id="emergency-section" class="hidden">
            <h1>Location-Based Emergency Resources</h1>
            <p>If you're in immediate danger, please call 911 (or your local emergency number).</p>
            <div class="location-finder">
                <div class="emergency-controls">
                    <select id="place-type-filter">
                        <option value="mental_health">Mental Health Support</option>
                        <option value="hospital">Hospitals</option>
                        <option value="police">Police Stations</option>
                    </select>
                    <button id="find-nearby-btn" class="cta-button"><i class="fas fa-map-marker-alt"></i> Find Help Near Me</button>
                </div>
                <div id="location-status"><p>Select a service type and click the button to find help on the map.</p></div>
                <div id="map"></div>
                <div id="emergency-results-container" class="hidden">
                    <h3>Results</h3>
                    <div id="emergency-results" class="resource-grid"></div>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings-section" class="hidden">
            <h1>Settings</h1>
            <div class="settings-container">
                <div class="setting-card">
                    <h3>Change Your PIN</h3>
                    <p>Your 4-digit PIN protects your journal and your account access.</p>
                    <button id="change-pin-btn" class="cta-button">Change PIN</button>
                </div>
                <div class="setting-card">
                    <h3>About You (Optional & Private)</h3>
                    <p class="privacy-notice">This information is stored securely and is only used to help BigSister understand you better during a conversation.</p>
                    <textarea id="user-profile-textarea" rows="6" placeholder="Tell me anything you'd like me to remember (e.g., your pronouns, things you're struggling with, your goals)."></textarea>
                    <button id="save-profile-btn" class="cta-button">Save Info</button>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about-section" class="hidden">
            <div class="about-container">
                <img src="{{ url_for('static', filename='img/BigSister.png') }}" alt="BigSister Logo" class="about-logo">
                <h1>About BigSister</h1>
                <p>Big Sister is a personal project that grew out of my passion for supporting mental health through technology...</p>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 BigSister | <a href="#" id="privacy-link" data-translate-key="footer_privacy">Privacy Policy</a> | <a href="#" id="tos-link" data-translate-key="footer_tos">Terms of Service</a></p>
    </footer>

    <!-- Modals (PIN & TOS) -->
    <div id="pin-modal" class="modal"><div class="modal-content"><h2 id="pin-modal-title"></h2><p id="pin-modal-prompt"></p><div class="pin-input-area"><input type="password" class="pin-input" maxlength="1"><input type="password" class="pin-input" maxlength="1"><input type="password" class="pin-input" maxlength="1"><input type="password" class="pin-input" maxlength="1"></div><p id="pin-error" class="error-message"></p><div class="modal-buttons"><button id="pin-submit-btn" class="cta-button"></button><button id="pin-cancel-btn" class="cta-button secondary-btn">Cancel</button></div></div></div>
    <div id="tos-modal" class="modal"><div class="modal-content"><span class="close-button">&times;</span><h2 data-translate-key="tos_title">Terms of Service & Privacy</h2><div class="modal-body"><p><strong data-translate-key="tos_last_updated">Last Updated: October 2024</strong></p><p data-translate-key="tos_purpose_text">BigSister is an AI chatbot designed for compassionate mental and emotional health support...</p></div></div></div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>